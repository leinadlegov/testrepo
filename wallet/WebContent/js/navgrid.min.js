var TVSettings={};var TVStyles={};var TVVisualTools={refresh:function(a){if(a.css("display")!="none"){a.hide();a.show()}},loadImage:function(b,c,a){if(a==undefined){a=true}if(c!=undefined&&c!=""){if(b.attr("src")==c){if(a){b.fadeIn(TVSettings.ANIMATION_DUR)}else{b.show()}}else{b.hide();if(a){if(b.attr("tsi:load")!="attached"){b.attr("tsi:load","attached");b.load(function(){$(this).fadeIn(TVSettings.ANIMATION_DUR)})}}else{b.show()}b.attr("src",c)}}else{b.hide()}}};function TVItemSelector(){var h=-1;var g=-1;var a=0;var j=0;var c=0;var e=0;var f={};var b={};var k={};var i=[];var d=false;this.delegate=null;this.registerItem=function(l,m,n){if(f[l]==undefined){f[l]=new Object()}if(b[l]==undefined){b[l]=0}if(k[m]==undefined){k[m]=0}n.innerIndex=i.length;n.posX=l;n.posY=m;n.isEnabled=true;i.push(n);f[l][m]=n;b[l]++;k[m]++;if(l<a){a=l}if(l>j){j=l}if(m<c){c=m}if(m>e){e=m}return n};this.unregisterItem=function(l,m){if(l!=undefined&&m==undefined){if(l.posX!=undefined){l=l.posX}if(l.posY!=undefined){m=l.posY
}}if(f[l]!=undefined&&f[l][m]!=undefined){var n=f[l][m];i.splice(n.innerIndex,1);f[l][m]=undefined;b[l]--;k[m]--;return n}return null};this.clear=function(){h=-1;g=-1;a=0;j=0;c=0;e=0;f={};b={};k={};i=[]};this.containsItems=function(m){if(m!=null){for(var l in f){for(var n in f[l]){if(f[l][n]==m){return true}}}}return false};this.getItem=function(l,m){if(f[l]!=undefined&&f[l][m]!=undefined){return f[l][m]}return null};this.getIndex=function(m){for(var l=0;l<i.length;l++){if(m==i[l]){return l}}return -1};this.size=function(){return i.length};this.sizeX=function(){return j-a};this.sizeY=function(){return e-c};this.foreach=function(m){for(var l=0;l<i.length;l++){m(l,i[l])}};this.itemsCountInRow=function(l){if(b[l]!=undefined){return b[l]}return 0};this.itemsCountInColumn=function(l){if(k[l]!=undefined){return k[l]}return 0};this.lowestX=function(){return a};this.lowestXinY=function(l){if(k[l]!=undefined){var n=k[l];for(var m in f){if(f[m][l]!=undefined&&m*1<n){n=m*1}}return n}return -1};this.highestX=function(){return j
};this.highestXinY=function(m){if(k[m]!=undefined){var l=0;for(var n in f){if(f[n][m]!=undefined&&n*1>l){l=n*1}}return l}return -1};this.lowestY=function(){return c};this.lowestYinX=function(l){if(b[l]!=undefined){var n=0;for(var m in f){for(var o in f[m]){if(o*1<n){n=o*1}}}return n}return -1};this.highestY=function(){return e};this.highestYinX=function(m){if(b[m]!=undefined){var l=0;for(var n in f){for(var o in f[n]){if(o*1>l){l=o*1}}}return l}return -1};this.overflowX=function(l){var m=g;var p=0;var o=null;var n=0;while(o==null){n=0;if(m-p>=c&&o==null){o=this.selectPos(l,m-p);n++}if(m+p<=e&&o==null){o=this.selectPos(l,m+p);n++}p++;if(n==0){break}}return o};this.overflowY=function(m){var l=h;var p=0;var o=null;var n=0;while(o==null){n=0;if(l-p>=a&&o==null){o=this.selectPos(l-p,m);n++}if(l+p<=j&&o==null){o=this.selectPos(l+p,m);n++}p++;if(n==0){break}}return o};this.setOverflowAllowed=function(l){d=l};this.isOverflowAllowed=function(){return d};this.getSelectedX=function(){return h};this.getSelectedY=function(){return g
};this.getSelectedItem=function(){return this.getItem(h,g)};this.getSelectedIndex=function(){return this.getIndex(this.getSelectedItem())};this.disableItem=function(l){if(l!=null&&this.containsItems(l)){if(l.isEnabled){l.isEnabled=false;if(typeof l.disabled=="function"){l.disabled(this)}if(l==this.getSelectedItem()){this.selectFirstAvailable()}}}};this.disableItemAtPos=function(l,m){this.disableItem(this.getItem(l,m))};this.enableItem=function(l){if(l!=null&&this.containsItems(l)){if(!l.isEnabled){l.isEnabled=true;if(typeof l.enabled=="function"){l.enabled(this)}}}};this.enableItemAtPos=function(l,m){this.enableItem(this.getItem(l,m))};this.isItemEnabled=function(l){if(l!=null&&this.containsItems(l)){return l.isEnabled}return false};this.isItemEnabledAtPos=function(l,m){return this.isItemEnabled(this.getItem(l,m))};this.clearSelection=function(){var l=this.getSelectedItem();if(l!=null){this.selectionChanged(l,null)}h=-1;g=-1};this.selectFirstAvailable=function(){var n=this;var l=false;var m=null;
this.foreach(function(p,o){if(!l&&o.isEnabled){m=n.selectItem(o);l=true}});if(!l){this.clearSelection()}return m};this.selectionChanged=function(l,o){if(l!=undefined&&l!=null&&l.isEnabled&&typeof l.unselected=="function"){l.unselected(this)}if(o!=undefined&&o!=null&&o.isEnabled&&typeof o.selected=="function"){o.selected(this)}for(var m=0;m<i.length;m++){var n=i[m];if(typeof n.selectionChanged=="function"){n.selectionChanged(this)}}if(this.delegate!=null&&typeof this.delegate.selectionChanged=="function"){this.delegate.selectionChanged(this)}};this.selectItem=function(n){if(n!=null){var o=this.getSelectedItem();for(var m in f){for(var l in f[m]){if(f[m][l]==n){if(!n.isEnabled){return null}if(n!=o){h=m*1;g=l*1;this.selectionChanged(o,n)}return n}}}}return null};this.selectPos=function(l,m){var o=this.getSelectedItem();if(f[l]!=undefined&&f[l][m]!=undefined){var n=f[l][m];if(!n.isEnabled){return null}h=l*1;g=m*1;if(n!=o){this.selectionChanged(o,n)}return n}return null};this.selectNextX=function(){var p=null;
var l=h+1;var m=g;var o=0;var q=0;var n=0;while(p==null){q=0;if(m-o>=c){n=this.highestXinY(m-o);l=h+1;while(l<=n&&p==null){p=this.selectPos(l,m-o);l++}q++}if(o>0&&m+o<=e){n=this.highestXinY(m+o);l=h+1;while(l<=n&&p==null){p=this.selectPos(l,m+o);l++}q++}o++;if(q==0){break}}if(p==null&&d){p=this.overflowX(a)}return p};this.selectPreviousX=function(){var p=null;var m=h-1;var n=g;var o=0;var q=0;var l=0;while(p==null){q=0;if(n-o>=c){l=this.lowestXinY(n-o);m=h-1;while(m>=l&&p==null){p=this.selectPos(m,n-o);m--}q++}if(o>0&&n+o<=e){l=this.lowestXinY(n+o);m=h-1;while(m>=l&&p==null){p=this.selectPos(m,n+o);m--}q++}o++;if(q==0){break}}if(p==null&&d){p=this.overflowX(j)}return p};this.selectNextY=function(){var p=null;var l=h;var m=g+1;var n=0;var q=0;var o=0;while(p==null){q=0;if(l-n>=a){o=this.highestYinX(l-n);m=g+1;while(m<=o&&p==null){p=this.selectPos(l-n,m);m++}q++}if(n>0&&l+n<=j){o=this.highestYinX(l+n);m=g+1;while(m<=o&&p==null){p=this.selectPos(l+n,m);m++}q++}n++;if(q==0){break}}if(p==null&&d){p=this.overflowY(c)
}return p};this.selectPreviousY=function(){var p=null;var m=h;var n=g-1;var o=0;var q=0;var l=0;while(p==null){q=0;if(m-o>=a){l=this.lowestYinX(m-o);n=g-1;while(n>=l&&p==null){p=this.selectPos(m-o,n);n--}q++}if(o>0&&m+o<=j){l=this.lowestYinX(m+o);n=g-1;while(n>=l&&p==null){p=this.selectPos(m+o,n);n--}q++}o++;if(q==0){break}}if(p==null&&d){p=this.overflowY(e)}return p};this.selectYInX=function(n){var p=null;var m=g+n;var l=h;var o=0;var q=0;while(p==null){q=0;if(l-o>=a&&p==null){p=this.selectPos(l-o,m);q++}if(o>0&&l+o<=j&&p==null){p=this.selectPos(l+o,m);q++}o++;if(q==0){break}}return p};this.selectXInY=function(n){var p=null;var l=h+n;var m=g;var o=0;var q=0;while(p==null){q=0;if(m-o>=c&&p==null){p=this.selectPos(l,m-o);q++}if(o>0&&m+o<=e&&p==null){p=this.selectPos(l,m+o);q++}o++;if(q==0){break}}return p}}function TVNavGrid(){var a=new TVItemSelector();this.delegate=null;this.clear=function(){a=new TVItemSelector()};this.registerItem=function(d,b,c){a.registerItem(d,b,c)};this.createItems=function(g,i){var h=$("#"+g);
if(h.attr("tsi:sizex")!=undefined&&h.attr("tsi:sizey")!=undefined){var e=h.attr("tsi:sizex")*1;var d=h.attr("tsi:sizey")*1;var b=(h.attr("tsi:count")!=undefined)?h.attr("tsi:count")*1:-1;var k=h.attr("tsi:style");var c=0;var q=undefined;if(k!=undefined&&TVStyles[k]!=undefined){q=TVStyles[k].classNormal}var j=h.html();var m="";var l=0;var p=0;if(q!=undefined){h.html('<div id="'+g+'_temp" class="'+q+'"></div>');var r=$("#"+g+"_temp");l=parseInt(r.css("width"),10);p=parseInt(r.css("height"),10)}for(var f=0;f<d;f++){for(var s=0;s<e;s++){if(b>=0&&c<b){var n=""+h.attr("id")+"_"+s+"_"+f;var o="left:"+(l*s)+"px;top:"+(p*f)+"px;";m+='<div id="'+n+'" tsi:posx="'+s+'" tsi:posy="'+f+'" style="'+o+'">'+j+"</div>";c++}}}h.html(m)}this.registerItems(g,i)};this.registerItems=function(i,d){var e=this;var c=$("#"+i);var j=c.attr("tsi:style");var h=c.attr("tsi:layout");var b=0;var f=0;if(h!=undefined){c.append('<div id="'+i+'_temp" class="'+h+'"></div>');var g=$("#"+i+"_temp");b=parseInt(g.css("top"),10);
f=parseInt(g.css("left"),10);g.remove()}c.children().each(function(p){var o=$(this);o.controlId=o.attr("id");if(o.controlId==undefined){o.controlId=i+"_"+p;o.attr("id",o.controlId)}o.contentId=o.controlId+"_c";o.action=o.attr("tsi:action");o.type=o.attr("tsi:type");o.style={};var q=o.attr("tsi:posx")*1;var n=o.attr("tsi:posy")*1;var k=o.html();var m="";var l=o.attr("tsi:style");if(l==undefined){l=j}if(l!=undefined&&TVStyles[l]!=undefined){o.style=TVStyles[l]}if(o.style.imgNormal!=undefined){m+='<img class="'+o.style.imgClass+'" src="'+o.style.imgNormal+'" tsi:state="normal"/>'}if(o.style.imgFocused!=undefined){m+='<img class="'+o.style.imgClass+'" src="'+o.style.imgFocused+'" tsi:state="focused" style="display:none;"/>'}if(o.style.imgPressed!=undefined){m+='<img class="'+o.style.imgClass+'" src="'+o.style.imgPressed+'" tsi:state="pressed" style="display:none;"/>'}if(o.style.imgDisabled!=undefined){m+='<img class="'+o.style.imgClass+'" src="'+o.style.imgDisabled+'" tsi:state="disabled" style="display:none;"/>'
}if(o.style.backClassNormal!=undefined){m+='<div class="'+o.style.backClassNormal+'" tsi:state="normal"></div>'}if(o.style.backClassFocused!=undefined){m+='<div class="'+o.style.backClassFocused+'" tsi:state="focused" style="display:none;"></div>'}if(o.style.backClassPressed!=undefined){m+='<div class="'+o.style.backClassPressed+'" tsi:state="pressed" style="display:none;"></div>'}if(o.style.backClassDisabled!=undefined){m+='<div class="'+o.style.backClassDisabled+'" tsi:state="disabled" style="display:none;"></div>'}if(o.style.classNormal!=undefined){m+='<div id="'+o.contentId+'" class="'+o.style.classNormal+'">'+k+"</div>"}else{m+=k}o.html(m);if(h!=undefined){o.css("left",(q*f)+"px");o.css("top",(n*b)+"px")}o.selected=function(){if(!o.isEnabled){return}if(o.style.classFocused!=undefined){$("#"+o.contentId).attr("class",o.style.classFocused)}$("#"+o.controlId).children().each(function(r){if($(this).attr("tsi:state")=="focused"){$(this).show()}else{if($(this).attr("tsi:state")!=undefined){$(this).hide()
}}});TVVisualTools.refresh(c)};o.unselected=function(){if(!o.isEnabled){return}if(o.style.classNormal!=undefined){$("#"+o.contentId).attr("class",o.style.classNormal)}$("#"+o.controlId).children().each(function(r){if($(this).attr("tsi:state")=="normal"){$(this).show()}else{if($(this).attr("tsi:state")!=undefined){$(this).hide()}}});TVVisualTools.refresh(c)};o.disabled=function(){if(o.style.classDisabled!=undefined){$("#"+o.contentId).attr("class",o.style.classDisabled)}if(o.style.classDisabled==undefined){$("#"+o.controlId).css("opacity",0.5)}$("#"+o.controlId).children().each(function(r){if($(this).attr("tsi:state")=="disabled"){$(this).show()}else{if($(this).attr("tsi:state")!=undefined){$(this).hide()}}})};o.enabled=function(){if(o.style.classNormal!=undefined){$("#"+o.contentId).attr("class",o.style.classNormal)}if(o.style.classDisabled==undefined){$("#"+o.controlId).css("opacity",1)}$("#"+o.controlId).children().each(function(r){if($(this).attr("tsi:state")=="normal"){$(this).show()
}else{if($(this).attr("tsi:state")!=undefined){$(this).hide()}}})};o.executed=function(){if(!o.isEnabled){return}if(TVSettings.ANIMATE){$("#"+o.controlId).children().each(function(r){if($(this).attr("tsi:state")=="pressed"){$(this).show();$(this).fadeOut(TVSettings.ANIMATION_DUR,function(){TVVisualTools.refresh($(this))})}})}};a.registerItem(q,n,o);if(typeof d=="function"){d(p,o)}if(TVSettings.MOUSE_SUPPORT_TYPE>0){o.click(function(){a.selectPos($(this).attr("tsi:posx")*1,$(this).attr("tsi:posy")*1);e.execute()})}})};this.foreach=function(b){a.foreach(b)};this.setOverflowAllowed=function(b){a.setOverflowAllowed(b)};this.isOverflowAllowed=function(){return a.isOverflowAllowed()};this.getSizeX=function(){return a.sizeX()};this.getSizeY=function(){return a.sizeY()};this.getSelectedIndex=function(){return a.getSelectedIndex()};this.getSelectedItem=function(){return a.getSelectedItem()};this.moveLeft=function(){a.selectPreviousX()};this.moveRight=function(){a.selectNextX()};this.moveUp=function(){a.selectPreviousY()
};this.moveDown=function(){a.selectNextY()};this.moveToPos=function(b,c){a.selectPos(b,c)};this.moveToId=function(c){var b=this.getItemForId(c);if(b!=null){a.selectItem(b)}};this.getItemAtPos=function(b,c){return a.getItem(b,c)};this.getItemForId=function(c){var b=null;a.foreach(function(e,d){if(d.controlId==c){b=d}});return b};this.disableItemAtPos=function(b,c){a.disableItemAtPos(b,c)};this.enableItemAtPos=function(b,c){a.enableItemAtPos(b,c)};this.disableItemForId=function(b){a.disableItem(this.getItemForId(b))};this.enableItemForId=function(b){a.enableItem(this.getItemForId(b))};this.getContentForItem=function(b){if(b!=null){return $("#"+b.contentId).html()}return null};this.setContentForItem=function(c,b){if(c!=null){$("#"+c.contentId).html(b)}};this.setItemContentAtPos=function(b,c,d){this.setContentForItem(this.getItemAtPos(b,c),d)};this.getItemContentAtPos=function(b,c){return this.getContentForItem(this.getItemAtPos(b,c))};this.setItemContentForId=function(c,b){this.setContentForItem(this.getItemForId(c),b)
};this.getItemContentForId=function(b){return this.getContentForItem(this.getItemForId(b))};this.execute=function(){var b=a.getSelectedItem();if(b!=null){if(typeof b.executed=="function"){b.executed()}if(this.delegate!=null&&typeof this.delegate.executeItem=="function"){this.delegate.executeItem(this,b)}}return b};this.handleAction=function(b){switch(b){case TVAction.LEFT:this.moveLeft();return true;case TVAction.RIGHT:this.moveRight();return true;case TVAction.UP:this.moveUp();return true;case TVAction.DOWN:this.moveDown();return true;case TVAction.EXECUTE:this.execute();return true}return false}};